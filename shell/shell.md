# Shell编程
## Shell简介
Shell 是一个命令解释权，它为用户提供了一个向 Linux 内核发送请求以便运行程序界面系统级程序，用户可以用 Shell 来启动、挂起、停止甚至是编写一些程序。

## Shell实例
#### 进入Linux终端，创建一个demo01.sh文件，用vim打开，编写shell脚本:
```
touch demo01.sh
vim demo01.sh

#!/bin/bash
echo 'hello'
```
#### 运行
```
#方法一
sh demo01.sh
#方法二
chmod +x demo01.sh
./demo01.sh
```
#### 终端输出hello。
#### 解释：
#! 告诉系统这个脚本需要什么解释器来执行。
文件扩展名 .sh 不是强制要求的。
方法1 直接运行解释器，demo01.sh 作为 Shell 解释器的参数。此时 Shell 脚本就不需要指定解释器信息，第一行可以去掉。
方法2 demo01.sh 作为可执行程序运行，Shell 脚本第一行一定要指定解释器。

## Shell变量

Shell 变量分为系统变量和自定义变量，显示当前 Shell 中所有变量：set 
变量名可以由字母、数字、下划线组成，不能以数字开头。

#### 基本语法

定义变量：变量名=变量值，等号两侧不能有空格，变量名一般习惯用大写。
删除变量：unset 变量名 。
声明静态变量：readonly 变量名，静态变量不能unset。
使用变量：$变量名

## Shell环境变量

#### 基本语法
export 变量名=变量值，将 Shell 变量输出为环境变量。
source 配置文件路径，让修改后的配置信息立即生效。
echo $变量名，检查环境变量是否生效

## 位置参数变量
#### 基本语法
```
$n ：$0 代表命令本身、$1-$9 代表第1到9个参数，10以上参数用花括号，如 ${10}。
$* ：命令行中所有参数，且把所有参数看成一个整体。
$@ ：命令行中所有参数，且把每个参数区分对待。
$# ：所有参数个数。
```
#### 实例
编写Shell脚本 demo02.sh ，输出命令行输入的各个参数信息。
```
#!/bin/bash     
# 输出各个参数 
echo $0 $1 $2 
echo $* 
echo $@ 
echo 参数数=$#
```
运行：
```
chmod +x demo02.sh
./demo02.sh 9 22
```
输出:
```
9 22
9 22
参数数=2
```
## 预定义变量
#### 定义
在赋值定义之前，事先在 Shell 脚本中直接引用的变量。
#### 基本语法
```
$$ ：当前进程的 PID 进程号。
$! ：后台运行的最后一个进程的 PID 进程号。
$? ：最后一次执行的命令的返回状态，0为执行正确，非0执行失败。
```
#### 实例
编写shell脚本 demo0.sh,输出命令行输入的各个参数信息。
```
#!/bin/bash     
echo 当前的进程号=$$ 
# &：以后台的方式运行程序 
./demo1.sh & 
echo 最后一个进程的进程号=$! 
echo 最后执行的命令结果=$?
```
#### 输出
```
当前的进程号=20452
最后一个进程的进程号=20453 
最后执行的命令结果=0 # hello
```
## 运算
#### 基本语法
```
$((运算式)) 或 $[运算式]
expr m + n 注意 expr 运算符间要有空格
expr m - n
expr \*，/，% 分别代表乘，除，取余
```
#### 实例
```
# 第1种方式 $(()) 
echo $(((4+4)*4))   

# 第2种方式 $[]，推荐 
echo $[(4+4)*4]  

# 使用 expr 
TEMP=`expr 4 + 4` 
echo `expr $TEMP \* 4`
``` 
## if
#### 基本语法
```
if [ 条件判断式 ];then   
    程序   
fi

# 或者（推荐）
if [ 条件判断式 ]
then
    程序
elif [ 条件判断式 ]
then
    程序
fi
```
#### 实例
编写shell：若输入参数大于30，输出“超时”，否则输出“过关”
```
#!/bin/bash
if [ $1 -ge 30 ]
then
    echo "超时"
elif [ $1 -lt 60 ]
then
    echo "过关" 
fi
```
## for
#### 基本语法
```
# 语法1
for 变量名 in 值1 值2 值3...
do
    程序
done

# 语法2
for ((初始值;循环控制条件;变量变化))
do
    程序
done
```
#### 实例
打印命令行输入的参数
```
#!/bin/bash  

# 使用$* 
for i in "$*" 
do     
    echo "the arg is $i" 
done 
echo "=================="  

# 使用$@ 
for j in "$@" 
do     
    echo "the arg is $j" 
done
```
## while
#### 基本语法
```
while [ 条件判断式 ]
do
    程序
done 
```
#### 实例
输出从1加到100的值
```
#!/bin/bash
SUM=0
i=0

while [ $i -le $1 ]
do
    SUM=$[$SUM+$i]
    i=$[$i+1]
done       
echo $SUM
```
## 读取控制台输入
#### 基本语法
read(选项)(参数)
-p：指定读取值时的提示符
-t：指定读取值时等待的时间（秒），如果没有在指定时间内输入，就不再等待了。
#### 实例
读取控制台输入一个num值
```
#!/bin/bash

read -p "请输入一个数num1=" NUM1
echo "你输入num1的值是：$NUM1"

read -t 10 -p "请在10秒内输入一个数num2=" NUM2
echo "你输入num2的值是：$NUM2"
```
#### 输出
```
请输入一个数num1=9
你输入num1的值是：9
请在10秒内输入一个数num2=22
你输入num2的值是：22
```
## 函数
### 系统函数
basename，删掉路径最后一个 / 前的所有部分（包括/），常用于获取文件名。
### 自定义函数
#### 基本语法
```
[ function ] funname[()]
{
    Action;
    [return int;]
}

# 调用
funname 参数1 参数2...
```
#### 实例
计算两个输入参数的和
```
#!/bin/bash

function getSum(){
    SUM=$[$n1+$n2]
    echo "sum=$SUM"
}   

read -p "请输入第一个参数n1：" n1
read -p "请输入第二个参数n2：" n2

# 调用 getSum 函数
getSum $n1 $n2
```

